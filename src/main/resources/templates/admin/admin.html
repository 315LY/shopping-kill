<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>员工管理</title>
    <link rel="shortcut icon" href="favicon.ico">
	<link href="../static/admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../static/admin/css/animate.css" rel="stylesheet">
    <link href="../static/admin/css/style.css?v=4.1.0" rel="stylesheet">
	<link href="../static/admin/css/bootstrap-editable.css" rel = "stylesheet" />
	<link href="../static/admin/css/bootstrapValidator.min.css" rel="stylesheet"/>
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
		<div class="col-sm-4" style="margin-bottom: 10px;">
		    <a data-toggle="modal" class="btn btn-success" href="#modal-form" data-toggle="modal" data-target="#myModal" id = "cle">添加人员</a>
	</div>
		
		<div class="row">
		    <div class="col-sm-12">
		        <div class="ibox float-e-margins">
		            <div class="ibox-title">
		                <h5>员工管理</h5>
		            </div>
		            <div class="ibox-content">
						<table id = "admin" class="footable table table-stripped toggle-arrow-tiny" data-page-size="8">
		                </table>
		            </div>
		        </div>
		    </div>
		</div>
	</div>
	
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel"></h4>
				</div>
				
				<div class="modal-body">
					<form role="form" id= "addAdmin"  enctype="application/x-www-form-urlencoded" method="post" action="http://test.wslhome.top/admin/addAdmin/v1">
						<div class="row">
							<div class="col-sm-6">
						    	<div class="form-group">
									<label class="col-xl-3 control-label">账号</label>
									<div class="col-xl-9">
										<input class="form-control" id = "name" name = "name"/>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xl-3 control-label">密码</label>
									<div class="col-xl-9">
										<input class="form-control" id = "password" name = "password"/>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xl-3 control-label">姓名</label>
									<div class="col-xl-9">
										<input class="form-control" id = "nickName" name = "nickName"/>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xl-3 control-label">性别</label>
									<div class="col-xl-9">
										<select  class="form-control" id="sex" name = "sex">
										    <option value="MAN">男</option>
										    <option value="WOMAN">女</option>
										</select>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label class="col-xl-3 control-label">身份证号</label>
									<div class="col-xl-9">
										<input class="form-control" id = "idCard" name = "idCard"/>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xl-3 control-label">手机号</label>
									<div class="col-xl-9">
										<input class="form-control" id= "phone" name = "phone"/>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xl-3 control-label">地址</label>
									<div class="col-xl-9">
										<input class="form-control" id= "address" name = "address"/>
									</div>
								</div>
								<div class="form-group">
									<label class="col-xl-3 control-label">邮箱</label>
									<div class="col-xl-9">
										<input class="form-control" id= "mail" name = "mail"/>
									</div>
								</div>
								</div>
							</div>
							<div class="modal-footer">
								<a type="button" class="btn btn-default" data-dismiss="modal">取消
								</a>
								<a type="button" class="btn btn-primary" id = "subs" data-dismiss="modal">
									确定
								</a>
							</div>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>
</body>
<!-- 全局js -->
<script src="../static/admin/js/jquery.min.js?v=2.1.4"></script>
<script src="../static/admin/js/bootstrap.min.js?v=3.3.6"></script>
<script src="../static/admin/js/jquery.form.js"></script>
<script src="../static/admin/js/jquery.cookie.js"></script>
<script src="../static/admin/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="../static/admin/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="../static/admin/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
<script src="../static/admin/js/bootstrap-editable.min.js"></script>
<script src="../static/admin/js/bootstrap-table-editable.js"></script>
<script src="../static/admin/js/bootstrapValidator.min.js"></script>


<script>
	
	$.ajaxSetup({
		headers: {
			'Authorization': $.cookie("token")
		},
		xhrFields: {
			withCredentials: false
		},
		crossDomain: true
	});
	
	$(function() {
		if ($.cookie("token") == null || $.cookie("token") == "") {
			window.location.href = "/admin/login.html"
		}
	});
	
	$(function() {
		$('#admin').bootstrapTable('destroy'); 
		$('#admin').bootstrapTable({
			method: 'get',
			url: "http://test.wslhome.top/admin/getAdminList/v1",
			dataType: "json",
			headers: {
				'Authorization': $.cookie("token")
			},
			ajaxOptions: {
			    xhrFields: {
			        withCredentials: false
			    },
			    crossDomain: true
			},
			striped: true,
			pageNumber: 1,
			pagination: true,
			sidePagination: 'server',
			pageSize: 15,
			pageList: [5, 10, 15,20, 30,50],
			showRefresh: false,
			silent: true, 
			cache: false,
			queryParams: null,
			clickToSelect: true,
			responseHandler: returnFormat,
			columns: [{
				title: 'Id',
				field: 'id',
				edit:true,
				sortable: true
			}, {
				title: '账户',
				field: 'name',
			}, {
				title: '姓名',
				field: 'nickName',
				editable: {
				    type: 'text',
				    title: '姓名',
				    validate: function (v) {
				        if (!v) return '用户名不能为空';
				
				    }
				}
			},{
				title: '密码',
				field: 'password',
				editable: {
					type: 'text',
					title: '姓名',
					validate: function (v) {
						if (!v) return '密码不能为空';

					}
				}
			},{
				title: '手机号',
				field: 'phone',
				editable: {
				    type: 'text',
				    title: '姓名',
				    validate: function (v) {
				        if (!v) return '手机号不能为空';
				
				    }
				}
			}, {
				title: '家庭住址',
				field: 'address',
				editable: {
				    type: 'text',
				    title: '姓名',
				    validate: function (v) {
				        if (!v) return '家庭住址不能为空';
				
				    }
				}
			}, {
				title: '邮箱',
				field: 'mail',
				editable: {
				    type: 'text',
				    title: '姓名',
				    validate: function (v) {
				        if (!v) return '家庭住址不能为空';
				
				    }
				}
			}, {
				title: '创建时间',
				field: 'creatTime',
				sortable: true
			}  , {
				title: '更新时间',
				field: 'updateTime',
				sortable: true
			}, {
				title: '操作',
				field: 'grade',
				formatter: function(value, row, index) {
					return '<button type="button" class="btn  btn-danger" style="margin:5px" onclick=" delActivity('+row.id+')">删除人员</button>';
				}
			}],
			onEditableSave: function (field, row, oldValue, $el) {
				if (row.sex =="男"){
					row.sex = "MAN";
				}else{
					row.sex = "WOMAX";
				}
				
                $.ajax({
                    type: "put",
                    url: "http://test.wslhome.top/admin/updateAdmin/v1",
                    data: row,
                    dataType: 'JSON',
                    success: function (msg) {
						console.log(msg);
                        if (msg.code==0 &&msg.data == true) {
                            alert('修改成功');
                        }else{
							alert('修改失败');
						}
                    },
                    error: function () {
                        alert('编辑失败');
                    },
                    complete: function () {
						$('#admin').bootstrapTable('refresh'); 
                    }

                })
			}
		})

		function returnFormat(res) {
			return {
				"rows":res.data
			};
		}
	})
	
	
	$("#subs").click(function() {
		$('#addAdmin').bootstrapValidator('validate');//触发
		$("#addAdmin").data('bootstrapValidator').validate();//校验
		if($('#addAdmin').data('bootstrapValidator').isValid()){  //是否通过
			$("#addAdmin").ajaxSubmit(function(re) {
		    	if (re.code == 0) {
		    		alert("编辑成功");
		    		$('#admin').bootstrapTable('refresh');
		    		window.location.reload()
		    	} else {
		    		alert(re.userMsg);
		    	}
		    	
		    });
		}		
		
	});
	
	
	function delActivity(id) {
		var mymessage = confirm("确认删除吗？");
		if (mymessage == true) {
			$.ajax({
				url: "http://test.wslhome.top/admin/delAdmin/v1",
				data: {
					id: id
				},
				type: 'delete',
				success: function(data) {
					if (data.code == 0) {
						alert("删除成功");
						$('#admin').bootstrapTable('refresh');
					} else {
						alert(data.userMsg);
					}
				},
				error: function(data) {
					alert("服务器繁忙");
				}
			});
	
		}
	
	}
	$('#addAdmin').bootstrapValidator({
	            message: 'This value is not valid',
	            feedbackIcons: {
	                valid: 'glyphicon glyphicon-ok',
	                invalid: 'glyphicon glyphicon-remove',
	                validating: 'glyphicon glyphicon-refresh'
	            },
	            fields: {
	                name: {
	                    message: '账户无效',
	                    validators: {
	                        notEmpty: {
	                            message: '账户不能为空'
	                        }
	                    }
	                },
	                password: {
	                    message:'密码无效',
	                    validators: {
	                        notEmpty: {
	                            message: '密码不能为空'
	                        },
	                        stringLength: {
	                            min: 6,
	                            max: 30,
	                            message: '密码长度必须在6到30之间'
	                        }
	                    }
	                },
	                email: {
	                    validators: {
	                        notEmpty: {
	                            message: '邮箱不能空'
	                        },
	                        emailAddress: {
	                            message: '邮箱地址不正确'
	                        }
	                    }
	                },
					sex:{
						validators: {
						    notEmpty: {
						        message: '性别不能空'
						    }
						}
					},
					nickName:{
						validators: {
						    notEmpty: {
						        message: '姓名不能空'
						    }
						}
					},
					idCard:{
						validators: {
						    notEmpty: {
						        message: '身份证号不能空'
						    },regexp: {
								regexp: /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/,
								message: '身份证号码格式不正确，为15位和18位身份证号码！'
							}
						}
					},
					phone:{
						validators: {
						    notEmpty: {
						        message: '手机号不能空'
						    },regexp: {
								regexp: /^1[34578]\d{9}$/,
								message: '请输入完整手机号码！'
							}
						}
					},
					address:{
						validators: {
						    notEmpty: {
						        message: '家庭住址不能空'
						    }
						}
					}
	            }
	        });

</script>
	    

</html>
	