<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>订阅管理</title>
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link rel="shortcut icon" href="favicon.ico"> <link href="../static/admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../static/admin/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../static/admin/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="../static/admin/css/animate.css" rel="stylesheet">
    <link href="../static/admin/css/style.css?v=4.1.0" rel="stylesheet">

</head>

<body class="gray-bg">
	
	<div class="row">
	    <div class="col-sm-12">
	        <div class="tabs-container">
	            <ul class="nav nav-tabs">
	                <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true" onclick="change(100)"> 短信订阅</a>
	                </li>
	                <li class=""><a data-toggle="tab" href="#tab-1" aria-expanded="false" onclick="change(1000)">邮箱订阅</a>
	                </li>
	            </ul>
	            <div class="tab-content">
	                <div id="tab-1" class="tab-pane active">
	                    <div class="panel-body">
							<div class="wrapper wrapper-content animated fadeInRight">
							    <div class="row">
							        <div class="col-sm-12">
							            <div class="ibox float-e-margins">
							                <div class="ibox-title">
							                    <h5 id = "title"></h5>
												<div style="text-align:right">
												    <a data-toggle="modal" style=" float:right;" class="btn btn-success" data-target="#EditModal" id = "addLimit">添加</a>
												</div>
							                </div>
							                <div class="ibox-content">
							                    
							                    <div class="table-responsive">
							                        <table id = "sub" class="table table-striped table-bordered table-hover dataTables-example"> 
							                        </table>	
													
							                    </div>
							                </div>
							            </div>
							        </div>
							    </div>
							</div>
	                    </div>
	                </div>
	            </div>
			</div>		
		</div>
	</div>		
	<div class="modal fade" id="EditModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id = "addNumber" enctype="application/x-www-form-urlencoded" action="http://test.wslhome.top/admin/addSubscriber/v1" method="post">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel">
							二次确认操作
						</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
						    <div class="form-group">
						        <label class="col-xl-3 control-label" id = "add"></label>
								<input id = "type" name = "type" value="" type="hidden"/>
						        <div class="col-xl-9">
						            <input type="text"  id = "number" name = "number" class="form-control layer-date" />
						        </div>
						    </div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消
						</button>
						<button id = "addsub" type="button" class="btn btn-primary" data-dismiss="modal">
							添加
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>


    <script src="../static/admin/js/jquery.min.js?v=2.1.4"></script>
    <script src="../static/admin/js/bootstrap.min.js?v=3.3.6"></script>
    <script src="../static/admin/js/jquery.form.js"></script>
    <script src="../static/admin/js/jquery.cookie.js"></script>
    <script src="../static/admin/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../static/admin/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="../static/admin/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
	
    
    <script>
	$.ajaxSetup({
		headers: {
			'Authorization': $.cookie("token")
		},
		xhrFields: {
			withCredentials: false
		},
		crossDomain: true
	});
	
	$(function() {
		if ($.cookie("token") == null || $.cookie("token") == "") {
			window.location.href = "/admin/login.html"
		}
	});
	
	var flag = true;	
	$(function(){
		var url = "http://test.wslhome.top/admin/getSubscriberBySms/v1";
		$("#title").html("短信订阅列表");
		logger(url);
		view();
	})
	function change(num){
		if (num == 100){
			url = "http://test.wslhome.top/admin/getSubscriberBySms/v1";
			flag = true;
		}else{
			url = "http://test.wslhome.top/admin/getSubscriberByEmail/v1";
			flag = false;
		}
		logger(url);
		view();
	}
	
	function view(){
		if (flag){
			$("#title").html("短信订阅列表");
			$("#add").html("短信订阅（手机号）");
			$("#type").val(1);
		}else{
			$("#title").html("邮箱订阅列表");
			$("#add").html("邮件订阅");
			$("#type").val(0);
		}
	}
		
	$("#addLimit").click(function(){
		view();
	})
	
	$("#addsub").click(function() {
		$("#addNumber").ajaxSubmit(function(re) {
			alert(re.userMsg);
			$('#sub').bootstrapTable('refresh');
		});
	});
	
	function logger(url) {
		$('#sub').bootstrapTable('destroy'); 
		$('#sub').bootstrapTable({
			method: 'get',
			url: url,
			dataType: "json",
			headers: {
				'Authorization': $.cookie("token")
			},
			ajaxOptions: {
			    xhrFields: {
			        withCredentials: false
			    },
			    crossDomain: true
			},
			striped: true,
			pageNumber: 1,
			pagination: true,
			sidePagination: 'server',
			pageSize: 15,
			pageList: [5, 10, 15,20, 30,50],
			showRefresh: false,
			silent: true, 
			cache: false,
			queryParams: queryParams,
			responseHandler: returnFormat,
			columns: [{
				checkbox : true
			},{
				title: 'Id',
				field: 'id',
				sortable: true
			},{
				title: '号码',
				field: 'number',
				sortable: true
			}, {
				title: '是否订阅',
				field: 'status',
				formatter: function(value, row, index) {
					if (row.status == 0){
						return "是";
					}else{
						return "否";
					}
				}
			},{
				title:"操作",
				field: 'Button',
				align: 'center',
				formatter: function(value, row, index) {
				return '<a style="margin: 5px;" class="btn btn-danger" onclick = "delonly(' + row.id + ');">删除</a>';
				}
			}]
		})
		function queryParams(params) {
			var temp = {
				current : (params.offset / params.limit) + 1,
				size: params.limit				
			};
			return temp;
		}
	
		function returnFormat(res) {
		
			return {
				"rows":res.data.records,
				"total": res.data.total
			};
		}
	}
	
	function delonly(ids) {
		if (!confirm("是否确认删除？"))
		    return;
		$.ajax({
		    url : "http://test.wslhome.top/admin/delSubscriber/v1",
		    data : "id=" + ids,
		    type : "delete",
		    dataType : "json",
		    success : function(data) {
				alert(data.userMsg);
		        $('#sub').bootstrapTable('refresh');
		    }
		});
	}
	
	
	</script>
            
        
        </body>
        
        </html>
        